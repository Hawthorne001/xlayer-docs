# X Layer Setup RPC overview

This guide will help you quickly deploy an X Layer self-hosted RPC node, providing complete L2 blockchain data access services.

## Migration from Legacy Mainnet/Testnet

If you were previously running nodes on the legacy X Layer mainnet/testnet, please note:

- **Data migration**: Previous blockchain data is incompatible with current version
- **Configuration changes**: Updated bootnodes, network parameters, and configuration files
- **Fresh deployment required**: You'll need to deploy a completely new node instance

## System Requirements

- **Operating System**: Linux (Ubuntu 20.04+ recommended)
- **Memory**: Minimum 8GB, recommended 16GB+
- **Storage**: Minimum 100GB SSD, recommended 500GB+
- **Network**: Stable internet connection
- **Docker**: Docker 20.10+ and Docker Compose 2.0+

## Quick Deployment

### Option 1: One-Click Installation (Recommended)

The easiest way to deploy your X Layer RPC node with minimal configuration:

```
# One-command installation and setup
curl -fsSL https://raw.githubusercontent.com/okx/xlayer-toolkit/main/scripts/rpc-setup/one-click-setup.sh | bash
```

This script will:

- ✅ Automatically detect your system requirements
- ✅ Download the latest configuration files
- ✅ Prompt you for required parameters interactively
- ✅ Generate all necessary configuration files
- ✅ Start the RPC node services
- ✅ Verify the installation and show connection details

#### Interactive prompts will ask for:

- Network type: `testnet` or `mainnet` (currently only testnet is supported)
- L1 RPC URL - Ethereum L1 RPC endpoint
- L1 Beacon URL - Ethereum L1 Beacon chain endpoint
- Optional: Custom port mappings
- Optional: Data directory location

#### After installation, your RPC node will be available at:

- HTTP RPC: `http://localhost:8123`
- WebSocket: `ws://localhost:8546`

### Option 2: Manual Setup (Advanced Users)

For users who need custom configurations or want to understand the setup process:

**Note**: Currently only testnet is supported. Mainnet support will be available in future releases.

#### 1. Environment Setup

```
# Clone the project
git clone https://github.com/okx/xlayer-toolkit.git
cd xlayer-toolkit
git checkout main
cd scripts/rpc-setup

# Configure environment variables
cp env.example .env
```

#### 2. Configuration

Edit the `.env` file with necessary parameters:

```
L1_RPC_URL={your-l1-url}
L1_BEACON_URL={your-l1-beacon-url}

# Bootnode Configuration (Here for new testnet)
OP_NODE_BOOTNODE=enode://eaae9fe2fc758add65f44cfe4918e898e16b223294db8f0ddcbcab2773e75b47a68e8c7fb9f58a2628b77ec28309140490ccc9490e216bf1349e16bd20b8f13a@52.77.225.158:30303
OP_GETH_BOOTNODE=enode://2104d54a7fbd58a4085900035a3628f1e162833c901400d490ccc94de4d16ba6f1374fbc5976e15b05e1d2867aa3af1e49f72e0dcaf4cf1309d8ccc84ed1e8fc@52.77.225.158:9003

# Docker Images
OP_STACK_IMAGE_TAG=xlayer/op-stack:release-testnet
OP_GETH_IMAGE_TAG=xlayer/op-geth:release-testnet
```

**Configuration Notes:**

- **Docker Images**: Choose the appropriate image tags based on your target network:
  - **Testnet**: `xlayer/op-stack:release-testnet` and `xlayer/op-geth:release-testnet`
  - **Mainnet**: `xlayer/op-stack:release` and `xlayer/op-geth:release`

- **Bootnode Configuration**: The default values are configured for testnet. Mainnet bootnode addresses will be provided later.

- **L1 Network URLs**: Configure `L1_BEACON_URL` and `L1_RPC_URL` according to your target network (mainnet or testnet).

#### 3. Start Services

```
# Init data (for testnet)
./init.sh testnet

# Start all services (for testnet)
./start.sh testnet
```

The above scripts will automatically:

- ✅ Download genesis file and initialize geth with it
- ✅ Check environment variables
- ✅ Create necessary directories
- ✅ Generate JWT secret
- ✅ Start Docker services
- ✅ Display service information and management commands

#### 4. Service Management

**Stop services (preserves data):**

```
./stop.sh
```

**Complete environment reset (removes all data):**

```
# Stop services and remove data
./stop.sh
rm -rf ./data

# Re-initialize and start
./init.sh testnet
./start.sh testnet
```

**Note**: The `stop.sh` script stops services but preserves blockchain data. For a complete reset, you need to manually remove the `data` directory before re-initializing.

## Service Ports

|Service|Port|Protocol|Purpose|
|:----|:----|:----|:----|
|op-geth RPC|8123|HTTP|JSON-RPC API|
|op-geth WebSocket|8546|WebSocket|WebSocket API|
|op-node RPC|9545|HTTP|Consensus layer API|
|op-geth P2P|30303|TCP/UDP|P2P network|
|op-node P2P|9223|TCP/UDP|P2P network|
