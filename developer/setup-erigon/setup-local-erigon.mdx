# Setup Local X Layer Erigon Node
This guide helps you set up a local X Layer development environment using `xlayer-erigon` for testing smart contracts, experimenting with new code, and interacting with the network on your local machine without external dependencies.

<Tip title="Note">This setup creates a local X Layer node that syncs with the live network. For a completely isolated local blockchain, consider using a testnet configuration or local L1 setup.</Tip>

After completing this tutorial, you will have:
- A fully functional X Layer Erigon node
- JSON-RPC endpoint for local development
- Access to all standard Ethereum JSON-RPC methods
- Local block explorer capabilities (optional)

## Prerequisites
This tutorial requires the following tools to be installed on your machine:
- **Go 1.24+** (required to build xlayer-erigon)
- **Git** (to clone the repository)
- **Make** (for building the binary)

Install links:
- https://go.dev/doc/install
- https://git-scm.com/downloads

### System Requirements

| Resource | Minimum | Recommended | Notes |
| --- | --- | --- | --- |
| CPU | 8 vCPU | 16+ vCPU | More cores = faster sync |
| RAM | 16 GB | 64 GB | Higher RAM improves performance |
| Disk | 200 GB SSD | 500+ GB SSD | Storage grows over time |
| Network | Stable internet | High bandwidth | For L1 sync and data streaming |

### External Requirements
- **L1 Endpoint**: Ethereum mainnet RPC (Alchemy, Infura, or self-hosted)
- **Genesis File**: https://raw.githubusercontent.com/okx/Deploy/main/mainnet/genesis.json
- **Chain ID**: 196 (mainnet) / 195 (testnet)
- **Sequencer URL**: https://rpc.xlayer.tech
- **Data Streamer**: stream.xlayer.tech:8800

## Setup X Layer Erigon Node
Follow these steps to clone, build, and run your local X Layer Erigon node.

### 1. Clone and Build
```bash
# Clone the xlayer-erigon repository
git clone https://github.com/okx/xlayer-erigon.git
cd xlayer-erigon

# Optionally switch to the latest release tag
# Check https://github.com/okx/xlayer-erigon/releases for latest version
# git checkout vX.Y.Z

# Build the cdk-erigon binary (output at build/bin/cdk-erigon)
make cdk-erigon
```

### 2. Create Configuration File
Create a configuration file named `xlayerconfig-local.yaml` in the repo root. Note that these `zkevm.*` keys configure PP network components:

```yaml
datadir: /data/xlayer-erigon            # <- change to your path
chain: xlayer-mainnet
http: true
private.api.addr: localhost:9091

zkevm.l2-chain-id: 196
zkevm.l2-sequencer-rpc-url: https://rpc.xlayer.tech
zkevm.l2-datastreamer-url: stream.xlayer.tech:8800
zkevm.l1-rpc-url: https://mainnet.infura.io/v3/<YOUR_KEY>   # <- change to your L1 RPC
zkevm.l1-chain-id: 1

zkevm.address-sequencer: "0xAF9d27ffe4d51eD54AC8eEc78f2785D7E11E5ab1"
zkevm.address-zkevm: "0x2B0ee28D4D51bC9aDde5E58E295873F61F4a0507"
zkevm.address-rollup: "0x5132A183E9F3CB7C848b0AAC5Ae0c4f0491B7aB2"
zkevm.address-ger-manager: "0x580bda1e7A0CFAe92Fa7F6c20A3794F169CE3CFb"

zkevm.l1-rollup-id: 3
zkevm.l1-first-block: 19218658
zkevm.l1-block-range: 2000
zkevm.l1-query-delay: 1000
zkevm.datastream-version: 3
zkevm.increment-tree-always: true

http.api: [eth, debug, net, trace, web3, erigon, zkevm]
http.addr: 0.0.0.0
http.port: 8545
```

<Tip title="Security Note">Binding `http.addr` to `0.0.0.0` exposes your RPC on all interfaces. In production, restrict access with a firewall.</Tip>

### 3. Start Your Node
```bash
./build/bin/cdk-erigon --config "./xlayerconfig-local.yaml"
```

### 4. Verify Node is Running
```bash
curl -s -X POST http://127.0.0.1:8545 \
  -H 'Content-Type: application/json' \
  --data '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}'
```

If successful, you'll see a JSON response with the current block number. 

## Configuration & Sync Details
Your X Layer Erigon node will automatically sync with the live X Layer network using:
- **L1 Sync**: Pulls batch data and state updates from Ethereum L1
- **Data Streaming**: Receives real-time transaction data from the sequencer
- **Pessimistic Proofs**: Validates cross-chain state transitions

The node operates as a full archive node, storing complete transaction history and state.

## Testing Your Setup
Once your node is synced, you can interact with it using standard Ethereum tools:

```bash
# Check sync status
curl -s -X POST http://127.0.0.1:8545 \
  -H 'Content-Type: application/json' \
  --data '{"jsonrpc":"2.0","method":"eth_syncing","params":[],"id":1}'

# Get latest block
curl -s -X POST http://127.0.0.1:8545 \
  -H 'Content-Type: application/json' \
  --data '{"jsonrpc":"2.0","method":"eth_getBlockByNumber","params":["latest",false],"id":1}'

# Check chain ID
curl -s -X POST http://127.0.0.1:8545 \
  -H 'Content-Type: application/json' \
  --data '{"jsonrpc":"2.0","method":"eth_chainId","params":[],"id":1}'
``` 

## Connecting to MetaMask
<Tip title="Note">Make sure your Erigon node is running and synced before configuring MetaMask.</Tip>

To configure MetaMask to use your local X Layer Erigon node:

1. Open MetaMask and click on the network dropdown
2. Click **Add Network** â†’ **Add a network manually**
3. Fill in the network details:
    - **Network Name**: X Layer - Local Node
    - **New RPC URL**: http://localhost:8545
    - **Chain ID**: 196
    - **Currency Symbol**: OKB
    - **Block Explorer URL**: https://web3.okx.com/explorer/x-layer
4. Click **Save**

Your MetaMask will now use your local node for all X Layer transactions. You'll benefit from:
- No rate limits
- Full debug/trace capabilities  
- Complete transaction logs
- Faster response times

## For Testnet
To connect to testnet instead, update your configuration:
- Change `zkevm.l2-chain-id` to `195`
- Update RPC URLs to testnet endpoints
- Use Chain ID `195` in MetaMask
- Get testnet OKB from the faucet via OKX Exchange's "Withdraw to X Layer Testnet" feature

